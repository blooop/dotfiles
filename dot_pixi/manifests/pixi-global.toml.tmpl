{{- $profile := env "CHEZMOI_PROFILE" | default "full" -}}
{{- $enableRust := false -}}
{{- if hasKey . "enable_rust" -}}
{{-   $enableRust = .enable_rust -}}
{{- else if eq $profile "full" -}}
{{-   $enableRust = true -}}
{{- end -}}
version = 1

# === CORE TOOLS (always installed) ===

[envs.fzf]
channels = ["conda-forge"]
dependencies = { fzf = "*" }
exposed = { fzf = "fzf" }

[envs.fd-find]
channels = ["conda-forge"]
dependencies = { fd-find = "*" }
exposed = { fd = "fd" }

[envs.ripgrep]
channels = ["conda-forge"]
dependencies = { ripgrep = "*" }
exposed = { rg = "rg" }

[envs.chezmoi]
channels = ["conda-forge"]
dependencies = { chezmoi = "*" }
exposed = { chezmoi = "chezmoi" }

{{- if eq $profile "full" }}

# === FULL PROFILE TOOLS (host machines) ===

[envs.nvtop]
channels = ["conda-forge"]
dependencies = { nvtop = "*" }
exposed = { nvtop = "nvtop" }

[envs.htop]
channels = ["conda-forge"]
dependencies = { htop = "*" }
exposed = { htop = "htop" }

[envs.git-lfs]
channels = ["conda-forge"]
dependencies = { git-lfs = "*" }
exposed = { git-lfs = "git-lfs" }

[envs.git]
channels = ["conda-forge"]
dependencies = { git = "*" }
exposed = { git = "git", git-cvsserver = "git-cvsserver", git-receive-pack = "git-receive-pack", git-shell = "git-shell", git-upload-archive = "git-upload-archive", git-upload-pack = "git-upload-pack", gitk = "gitk", scalar = "scalar" }

[envs.openssh]
channels = ["conda-forge"]
dependencies = { openssh = "*" }
exposed = { scp = "scp", sftp = "sftp", ssh = "ssh", ssh-add = "ssh-add", ssh-agent = "ssh-agent", ssh-keygen = "ssh-keygen", ssh-keyscan = "ssh-keyscan", sshd = "sshd" }

[envs.ccache]
channels = ["conda-forge"]
dependencies = { ccache = "*" }
exposed = { ccache = "ccache" }

[envs.curl]
channels = ["conda-forge"]
dependencies = { curl = "*" }
exposed = { curl = "curl" }

[envs.neovim]
channels = ["https://prefix.dev/github-releases", "conda-forge"]
dependencies = { neovim = "*", gcc = "*", gxx = "*" }
exposed = { nvim = "nvim" }
{{- end }}

[envs.lazygit]
channels = ["conda-forge"]
dependencies = { lazygit = "*" }
exposed = { lazygit = "lazygit" }

[envs.unzip]
channels = ["conda-forge"]
dependencies = { unzip = "*" }
exposed = { unzip = "unzip" }

[envs.vim]
channels = ["conda-forge"]
dependencies = { vim = "*" }
exposed = { ex = "ex", rview = "rview", rvim = "rvim", view = "view", vim = "vim", vimdiff = "vimdiff", vimtutor = "vimtutor", xxd = "xxd" }

{{- if and $enableRust (eq $profile "full") }}

# === RUST (optional - installed only in full profile) ===

[envs.rust]
channels = ["conda-forge"]
dependencies = { rust = "*" }
exposed = { cargo = "cargo", cargo-clippy = "cargo-clippy", cargo-fmt = "cargo-fmt", clippy-driver = "clippy-driver", rust-analyzer = "rust-analyzer", rust-gdb = "rust-gdb", rust-gdbgui = "rust-gdbgui", rust-lldb = "rust-lldb", rustc = "rustc", rustdoc = "rustdoc", rustfmt = "rustfmt" }
{{- end }}
